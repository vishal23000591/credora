"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function c(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,c)}s((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TOTP=void 0;class TOTP{static generate(e,t){return __awaiter(this,void 0,void 0,function*(){const r=Object.assign({digits:6,algorithm:"SHA-1",encoding:"hex",period:30,timestamp:Date.now(),explicitZeroPad:!1},t),i=Math.floor(r.timestamp/1e3),n=TOTP.dec2hex(Math.floor(i/r.period)).padStart(16,"0"),a="hex"===r.encoding?TOTP.base32ToBuffer(e):TOTP.asciiToBuffer(e),o=yield TOTP.crypto.importKey("raw",a,{name:"HMAC",hash:{name:r.algorithm}},!1,["sign"]),c=yield TOTP.crypto.sign("HMAC",o,TOTP.hex2buf(n)),s=TOTP.buf2hex(c),T=2*TOTP.hex2dec(s.slice(-1)),h=(2147483647&TOTP.hex2dec(s.slice(T,T+8))).toString().slice(-r.digits),u=r.explicitZeroPad?h.padStart(r.digits,"0"):h,d=1e3*r.period;return{otp:u,expires:Math.ceil((r.timestamp+1)/d)*d}})}static hex2dec(e){return parseInt(e,16)}static dec2hex(e){return(e<15.5?"0":"")+Math.round(e).toString(16)}static base32ToBuffer(e){let t=(e=e.toUpperCase()).length;for(;61===e.charCodeAt(t-1);)t--;const r=new Uint8Array(5*t/8);let i=0,n=0,a=0;for(let o=0;o<t;o++){const t=TOTP.base32[e.charCodeAt(o)];if(void 0===t)throw new Error("Invalid base32 character in key");i=i<<5|t,n+=5,n>=8&&(r[a++]=i>>>(n-=8))}return r.buffer}static asciiToBuffer(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t.buffer}static hex2buf(e){const t=new Uint8Array(e.length/2);for(let r=0,i=0;r<e.length;r+=2,i++)t[i]=TOTP.hex2dec(e.slice(r,r+2));return t.buffer}static buf2hex(e){return[...new Uint8Array(e)].map(e=>e.toString(16).padStart(2,"0")).join("")}}exports.TOTP=TOTP,TOTP.crypto=(globalThis.crypto||require("node:crypto").webcrypto).subtle,TOTP.base32={50:26,51:27,52:28,53:29,54:30,55:31,65:0,66:1,67:2,68:3,69:4,70:5,71:6,72:7,73:8,74:9,75:10,76:11,77:12,78:13,79:14,80:15,81:16,82:17,83:18,84:19,85:20,86:21,87:22,88:23,89:24,90:25};